(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(e,t,n){e.exports=n.p+"static/media/photo_other.1969756e.jpg"},34:function(e,t,n){e.exports=n(63)},45:function(e,t,n){},47:function(e,t,n){},49:function(e,t,n){},51:function(e,t,n){e.exports=n.p+"static/media/photo.1fa99390.jpg"},52:function(e,t,n){},54:function(e,t,n){},56:function(e,t,n){},58:function(e,t,n){},60:function(e,t,n){},63:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(11),c=n.n(o),s=n(2),i=n(3),l=n(5),u=n(4),m=n(6),p=n(9),d=n(12),h=n(29),f=n(16);var v=Object(d.c)({signUp:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{status:0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SIGNUP":return Object.assign({},e,{status:t.payload.status});default:return e}},login:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{status:0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return Object.assign({},e,{status:t.payload.status});default:return e}},currentSession:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{session:null,allFriend:[]},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CURRENT_SESSION":return Object.assign({},e,{session:t.payload.session});case"FETCH_ALL_FRIEND":return Object.assign({},e,{allFriend:Object(f.a)(t.payload.allFriend)});default:return e}},message:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{msgList:{},currentMsg:[]},a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"ADD_TEXT_MSG":return Object.assign({},n,{msgList:function(e,t,n){var a=n[e]||[];return a.push(t),n[e]=a,Object.assign({},n)}(a.payload.to,a.payload.message,n.msgList)});case"GET_ALONE_MSG":return Object.assign({},n,{currentMsg:(e=a.payload.to,t=n.msgList,t[e]?Object(f.a)(t[e]):[])});default:return n}}}),g=[h.a],b=d.a.apply(void 0,g)(d.d)(v),E=n(30),N=n.n(E)()(),y=new WebIM.connection({isMultiLoginSessions:WebIM.config.isMultiLoginSessions,https:!1,url:WebIM.config.xmppURL,heartBeatWait:WebIM.config.heartBeatWait,autoReconnectNumMax:WebIM.config.autoReconnectNumMax,autoReconnectInterval:WebIM.config.autoReconnectInterval,apiUrl:WebIM.config.apiURL,isHttpDNS:WebIM.config.isHttpDNS,isWindowSDK:WebIM.config.isWindowSDK,isAutoLogin:!0,encrypt:WebIM.config.encrypt,delivery:WebIM.config.delivery}),j=null,O=function(){return j},k=n(64);n(45);var w,M,C,_=(M={active:!0,errorHandler:function(e){alert(e.displayName+"----"+e.method)}},function(e){M.active&&["render","componentWillMount","componentDidMount","componentWillReceiveProps","componentWillUpdate","componentDidUpdate","compoentnWillUnmount","shouldComponentUpdate"].forEach(function(t){var n="shouldComponentUpdate"===t?function(){return!0}:function(){return null},a=e.prototype[t]||n;M.errorHandler=M.errorHandler||function(e){console.log(e)},e.prototype[t]=function(){try{return a.call(this,arguments)}catch(o){var r={displayName:e.name,method:t,message:o.stack,state:this.state,props:this.props};return M.errorHandler(r),n.call(this,arguments)}}})}(w=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={hint:{header:"",button:"",account:"",footer:"",aLink:"",showNickName:!1},userName:"",password:"",nickName:""},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this;"signUp"===this.props.hint?this.setState({hint:{header:"\u6ce8\u518c",button:"\u6ce8\u518c",account:"\u5df2\u6709\u8d26\u6237",footer:"\u7acb\u5373\u767b\u5f55",aLink:"/login",showNickName:!0}}):this.setState({hint:{header:"\u767b\u5f55",button:"\u767b\u5f55",account:"\u6ca1\u6709\u8d26\u6237",footer:"\u7acb\u5373\u6ce8\u518c",aLink:"/signUp",showNickName:!1}}),this.changeInput=function(t){switch(t.target.name){case"userName":return e.setState({userName:t.target.value});case"password":return e.setState({password:t.target.value.trim()});case"nickName":return e.setState({nickName:t.target.value});default:return}},this.handleSubmit=function(t){t.preventDefault(),"signUp"===e.props.hint?e.props.handleSignUp(e.state):e.props.handleLogin(e.state)}}},{key:"render",value:function(){return r.a.createElement("div",{className:"signBasic"},r.a.createElement("header",null,r.a.createElement("div",{className:"header_inner"},r.a.createElement("h1",{className:"logo"},"\u5f20\u6cbb\u56fd \u804a\u5929\u5c0f\u4f5c\u54c1"),r.a.createElement("div",{className:"signUpBtn"},r.a.createElement(k.a,{to:this.state.hint.aLink},this.state.hint.footer)))),r.a.createElement("main",null,r.a.createElement("div",{className:"main_inner"},r.a.createElement("form",null,r.a.createElement("h3",null,this.state.hint.header),r.a.createElement("div",{className:"row"},r.a.createElement("i",{className:"iconfont icon-photo"}),r.a.createElement("input",{type:"text",name:"userName",placeholder:"\u7528\u6237\u540d",className:"input firstInput",value:this.state.userName,onChange:this.changeInput})),r.a.createElement("div",{className:"row"},r.a.createElement("i",{className:"iconfont icon-clock"}),r.a.createElement("input",{type:"password",name:"password",placeholder:"\u5bc6\u7801",className:"input",value:this.state.password,onChange:this.changeInput})),this.state.hint.showNickName?r.a.createElement("div",{className:"row"},r.a.createElement("i",{className:"iconfont icon-photo"}),r.a.createElement("input",{type:"text",name:"nickName",placeholder:"\u8f93\u5165\u6635\u79f0",className:"input",value:this.state.nickName,onChange:this.changeInput})):null,r.a.createElement("div",{className:"button_wrapper"},r.a.createElement("input",{type:"submit",name:"submit",className:"button",value:this.state.hint.button,onClick:this.handleSubmit}))))))}}]),t}(a.Component))||w),S=(n(47),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.type,n=e.content;return r.a.createElement("div",{className:"tooltips"},r.a.createElement("div",null,"".concat(t,": ").concat(n)))}}]),t}(a.Component));S.defaultProps={time:3e3,type:"success",content:""};var W=null;function I(){C&&(c.a.unmountComponentAtNode(C),C.parentNode.removeChild(C),C=null)}var U,L,T={show:function(e){C&&I(),C=document.createElement("div"),document.body.appendChild(C),c.a.render(r.a.createElement(S,e),C),W&&clearTimeout(W),W=setTimeout(function(){I()},e.time||3e3)},close:I},R=Object(p.b)(function(){return{}},{loginToServer:function(e){return function(t,n){return new Promise(function(t,n){e.success=function(e){t(e)},e.error=function(e){n(e)},sdk.conn.open(e)})}}})(U=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.handleLogin=function(t){if(t.userName&&t.password){var n={user:t.userName.trim(),pwd:t.password,appKey:WebIM.config.appkey,apiUrl:WebIM.config.apiURL};e.props.loginToServer(n).then(function(e){j=e,N.push("/chat")},function(e){T.show({type:"error",content:"\u767b\u5f55\u5931\u8d25\u4e86"})})}else T.show({type:"error",content:"\u8d26\u53f7\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"})}}},{key:"render",value:function(){return r.a.createElement(_,{hint:"login",handleLogin:this.handleLogin})}}]),t}(a.Component))||U,A=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];var o={type:e,payload:{}};return n.forEach(function(e,t){o.payload[n[t]]=a[t]}),o}},D=A("SIGNUP","status"),F=Object(p.b)(function(){return{}},{signUpToServer:function(e){return function(t,n){return new Promise(function(n,a){var r=e.success,o=e.error;e.success=function(){t(D(2)),r&&r(),n()},e.error=function(){t(D(3)),o&&o(),a()},sdk.conn.registerUser(e)})}}})(L=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.handleSignUp=function(t){if(t.userName&&t.password&&t.nickName){var n={username:t.userName.trim().toLowerCase(),password:t.password,nickname:t.nickName,appKey:WebIM.config.appkey,apiUrl:WebIM.config.apiURL};e.props.signUpToServer(n).then(function(){N.push("/login")},function(){T.show({content:"\u6ce8\u518c\u5931\u8d25\u4e86",type:"error"})})}else T.show({type:"error",content:"\u8d26\u53f7\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"})}}},{key:"render",value:function(){return r.a.createElement(_,{hint:"signUp",handleSignUp:this.handleSignUp})}}]),t}(a.Component))||L,x=(n(49),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=O(),t=e?e.user.username:"";return r.a.createElement("div",{className:"sb"},r.a.createElement("div",{className:"sb_header"},r.a.createElement("div",{className:"photo_wrapper avator"},r.a.createElement("img",{src:n(51),alt:""})),r.a.createElement("p",{className:"myNickName"},t)),r.a.createElement("div",{className:"sb_main"},r.a.createElement("div",{className:"icon_wrapper chat"},r.a.createElement("i",{className:"iconfont icon-chat"}))),r.a.createElement("div",{className:"sb_footer"},r.a.createElement("dir",{className:"icon_wrapper setting"},r.a.createElement("i",{className:"iconfont icon-shezhi"}))))}}]),t}(a.Component)),H=n(13),P=n.n(H),B=n(31),G=A("CURRENT_SESSION","session"),K=A("FETCH_ALL_FRIEND","allFriend");function J(){return function(e,t){return new Promise(function(t,n){sdk.conn.getRoster({success:function(n){var a=n.filter(function(e){return"both"===e.subscription});e(K(a)),t()},error:function(e){n()}})})}}var X=n(32),q=new(n.n(X).a),z=A("ADD_TEXT_MSG","to","message");function $(e,t){return function(n,a){var r;n(z(e,t)),(r=t,function(e,t){var n=r.body?r.body.to:r.from,a=t().currentSession.allFriend.map(function(e){var t=Object(B.a)({},e);return t.name===n&&(t.newMsg=r),t});e(K(a))})(n,a)}}n(52);var Q,V,Y=Object(p.b)(function(e){return{session:e.currentSession.session,msgList:e.message.msgList}},{addTextMsg:function(e,t,n){return function(a,r){var o=O().user.nickname,c=sdk.conn.getUniqueId(),s=new WebIM.message("txt",c);s.set({msg:t,to:e,roomType:!1,success:function(t,n){s.fromMe=!0,s.from=o,$(e,s)(a,r)},fail:function(e){alert("\u6d88\u606f\u5230\u670d\u52a1\u5668\u5931\u8d25")}}),s.body.chatType=n,sdk.conn.send(s.body)}}})(Q=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={message:"",aloneMessage:""},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.handleUserInput=function(t){e.setState({message:t.target.value})},this.sendMessage=function(){var t=e.props,n=t.addTextMsg,a=t.session,r=t.chatType,o=e.state.message;e.setState({message:""}),a&&""!==e.state.message.trim()&&n(a.name,o,r)},this.getAloneMessage=function(){var t=e.props,n=t.msgList,a=t.session;return a&&n[null!==a?a.name:""]||[]}}},{key:"componentDidUpdate",value:function(){this.mainRef.scrollTop=this.mainRef.scrollHeight}},{key:"render",value:function(){var e=this,t=this.props.session,n=this.getAloneMessage();return r.a.createElement("div",{className:"bp"},r.a.createElement("div",{className:"bp_header"},t?t.name:""),r.a.createElement("div",{className:"bp_main",ref:function(t){e.mainRef=t}},r.a.createElement("div",{className:"timeHint"}),n.map(function(e){return r.a.createElement(Z,{key:e.id,msg:e})})),r.a.createElement("div",{className:"bp_footer"},r.a.createElement("textarea",{name:"",id:"",cols:"30",rows:"10",placeholder:"\u8f93\u5165\u6d88\u606f",className:"textArea",value:this.state.message,onChange:this.handleUserInput}),r.a.createElement("div",{className:"sendButton",onClick:this.sendMessage},"\u53d1\u9001")))}}]),t}(a.Component))||Q,Z=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={hasError:!1},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidCatch",value:function(e,t){this.setState({hasError:!0})}},{key:"render",value:function(){return this.state.hasError?r.a.createElement("div",null,"\u51fa\u9519\u4e86\uff0c\u8bf7\u8054\u7cfbRD\u4fee\u590d"):r.a.createElement(ee,{msg:this.props.msg})}}]),t}(a.Component),ee=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.msg,t=!!e.fromMe,a=P()({mi_item:!0,you:!t,me:t});return r.a.createElement("div",{className:a},r.a.createElement("figure",{className:"mi_photo"},r.a.createElement("img",{src:n(25),alt:"\u5934\u50cf"})),r.a.createElement("div",{className:"mi_text"},e.value,r.a.createElement("div",{className:"san"})))}}]),t}(a.Component),te=n(14),ne=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.type,t=P()(Object(te.a)({iconfont:!0},"icon-"+e,!0));return r.a.createElement("span",{className:t})}}]),t}(a.Component),ae=(n(54),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.closeDialog=function(){re(),e.props.onClose&&e.props.onClose()}}},{key:"render",value:function(){var e=this.props,t=e.title,n=e.content,a=e.footer,o=e.showMask;return r.a.createElement("div",{className:"dlg_wrapper"},o?r.a.createElement("div",{className:"dlg_mask"}):null,r.a.createElement("div",{className:"dlg"},r.a.createElement("div",{className:"dlg_closeBtn",onClick:this.closeDialog},r.a.createElement(ne,{type:"guanbi"})),r.a.createElement("div",{className:"dlg_header"},t),r.a.createElement("div",{className:"dlg_main"},n),r.a.createElement("div",{className:"dlg_footer"},a)))}}]),t}(a.Component));function re(){V&&(c.a.unmountComponentAtNode(V),V.parentNode.removeChild(V),V=null)}ae.defaultProps={showMask:!0};var oe,ce,se,ie={show:function(e){V&&re(),V&&re(),V=document.createElement("div"),document.body.appendChild(V),c.a.render(r.a.createElement(ae,e),V)},close:re},le=n(20),ue=n.n(le),me=(n(56),Object(p.b)(function(e){return{allFriend:e.currentSession.allFriend}})(oe=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this;q.on("presence",function(t){"subscribe"===t.type&&ie.show({title:"\u6dfb\u52a0\u597d\u53cb",content:r.a.createElement("div",{className:"sl_dlg_header_inner"},r.a.createElement("p",{className:"who"},t.from,"\u9080\u8bf7\u52a0\u4f60\u4e3a\u597d\u53cb"),r.a.createElement("p",{className:"message"},"\u7559\u8a00\uff1a",t.status)),footer:r.a.createElement("div",{className:"sl_dlg_footer_inner"},r.a.createElement("button",{className:"reject",onClick:e.reject.bind(e,t)},"\u62d2\u7edd"),r.a.createElement("button",{className:"accept",onClick:e.accept.bind(e,t)},"\u540c\u610f"))})}),this.accept=function(e){sdk.conn.subscribed({to:e.from,message:"[resp:true]"}),sdk.conn.subscribe({to:e.from,message:"[resp:true]"}),ie.close()},this.reject=function(e){sdk.conn.unsubscribed({to:e.from,message:"rejectAddFriend"}),ie.close()},this.showAddFriend=function(){ie.show({title:"\u6dfb\u52a0\u597d\u53cb",content:r.a.createElement("div",{className:"sb_dlg_header_inner"},r.a.createElement("input",{type:"text",placeholder:"\u8f93\u5165\u540d\u5b57",ref:function(t){e.nickNameRef=t}})),footer:r.a.createElement("div",{className:"sb_dlg_footer_inner"},r.a.createElement("div",{className:"button",onClick:e.confirmAddFriend},"\u786e\u5b9a"))})},this.confirmAddFriend=function(){sdk.conn.subscribe({to:e.nickNameRef.value.trim(),message:"\u4f60\u597d\uff0c\u6211\u662f\u5f20\u6cbb\u56fd\uff0c\u4ea4\u4e2a\u670b\u53cb\u5457\uff01"}),ie.close()}}},{key:"componentWillUnmount",value:function(){q.removeListener("presence",this.handlePresence)}},{key:"render",value:function(){var e=this.props,t=e.chatId,n=e.allFriend;return r.a.createElement("div",{className:"sessionList"},r.a.createElement("div",{className:"addFriendBtn"},r.a.createElement("i",{className:"iconfont icon-hao",onClick:this.showAddFriend})),r.a.createElement("ul",null,0===n.length?null:n.map(function(e){var n=t===e.name;return r.a.createElement("li",{key:e.name,className:n?"list listActive":"list"},r.a.createElement(pe,{friend:e}))})))}}]),t}(a.Component))||oe),pe=Object(p.b)(function(){return{}},{currentSessionActon:G})(ce=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.itemClick=function(){var t=e.props;(0,t.currentSessionActon)(t.friend)}}},{key:"shouldComponentUpdate",value:function(e,t){return!ue()(this.props.friend,e.friend)||!ue()(this.props.isSelected,e.isSelected)}},{key:"render",value:function(){var e=this.props.friend,t={pathname:"/chat/single/".concat(e.name),state:{chatType:"single",friendName:"".concat(e.name)}};return r.a.createElement("div",{className:"sessionItem"},r.a.createElement(k.a,{to:t,onClick:this.itemClick},r.a.createElement("div",{className:"sm_lf"},r.a.createElement("img",{src:n(25),alt:""})),r.a.createElement("div",{className:"sm_rt"},r.a.createElement("h3",null,e.name),r.a.createElement("p",null,e.newMsg?e.newMsg.value:""))))}}]),t}(a.Component))||ce,de=me,he=(n(58),Object(p.b)(function(){return{}},{init:function(){return function(e,t){sdk.conn.listen({onOpened:function(){e(J())},onTextMessage:function(n){n.value=n.value||n.data,$(n.from,n)(e,t)},onRoster:function(){e(J())},onPresence:function(e){q.emit("presence",e)}})}}})(se=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){this.props.init()}},{key:"render",value:function(){var e=Object.assign({},this.props.location.state),t=e.chatType,n=e.friendName;return r.a.createElement("div",{className:"ctn-chat"},r.a.createElement(x,null),r.a.createElement(de,{chatType:t,chatId:n}),r.a.createElement(Y,{chatType:t,chatId:n}))}}]),t}(a.Component))||se),fe=n(66),ve=n(65);n(60);window.sdk={conn:y};var ge=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=O();return r.a.createElement("div",null,e||"/login"===N.location.pathname?null:N.push("/login"))}}]),t}(a.Component),be=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement(p.a,{store:b},r.a.createElement(fe.a,null,r.a.createElement("div",{className:"app_Wrapper"},r.a.createElement(ve.a,{path:"/",component:ge}),r.a.createElement(ve.a,{path:"/signUp",component:F}),r.a.createElement(ve.a,{path:"/login",component:R}),r.a.createElement(ve.a,{path:"/chat",component:he}))))}}]),t}(a.Component),Ee=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ne(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}c.a.render(r.a.createElement(be,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/WeChat-2018/build",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/WeChat-2018/build","/service-worker.js");Ee?function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Ne(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e):Ne(e)})}}()}},[[34,2,1]]]);
//# sourceMappingURL=main.fa79e80f.chunk.js.map